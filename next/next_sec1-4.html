<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Next.js ã¨ PHP ã‚’é€£æºã—ã¦ SPA é€šä¿¡ã™ã‚‹æ–¹æ³•</title>
  <style>
    body { font-family: sans-serif; line-height: 1.8; padding: 2em; background: #f8f8f8; color: #333; }
    h1, h2, h3 { color: #2c3e50; }
    pre { background: #eee; padding: 1em; border-radius: 6px; overflow-x: auto; }
    code { background: #e0e0e0; padding: 2px 6px; border-radius: 4px; }
    ul { margin-left: 1.5em; }
  </style>
</head>
<body>

  <h1>Next.js ã§ PHP ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ SPA é€šä¿¡ã™ã‚‹æ–¹æ³•</h1>

  <p>Next.jsï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ã¨ PHPï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ã‚’é€£æºã•ã›ã¦ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹SPAçš„ãªé€šä¿¡å‡¦ç†ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚</p>

  <h2>ğŸ“Œ æ§‹æˆã‚¤ãƒ¡ãƒ¼ã‚¸</h2>
  <ul>
    <li>Next.jsï¼ˆé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼‰ï¼š<code>http://localhost:3000</code></li>
    <li>PHPï¼ˆXAMPPãªã©Apacheï¼‰ï¼š<code>http://localhost/next_demo2/backend/backend1.php</code></li>
  </ul>

  <h2>âœ… Next.jså´ã®ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆapp/dog/page.tsxï¼‰</h2>

  <pre><code>'use client';

import { useState } from 'react';

export default function DogPage() {
  const [response, setResponse] = useState('');
  const [loading, setLoading] = useState(false);

  const fetchData = async () => {
    setLoading(true);
    try {
      const res = await fetch('http://localhost/next_demo2/backend/backend1.php');
      if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
      const data = await res.json();
      setResponse(JSON.stringify(data, null, 2));
    } catch (error) {
      setResponse('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error);
    } finally {
      setLoading(false);
    }
  };

  return (
    &lt;main className="p-6"&gt;
      &lt;h1 className="text-2xl font-bold mb-4"&gt;PHPã¨é€šä¿¡ã™ã‚‹Next.jsãƒ‡ãƒ¢&lt;/h1&gt;
      &lt;button
        className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
        onClick={fetchData}
        disabled={loading}
      &gt;
        {loading ? 'é€šä¿¡ä¸­...' : 'PHPã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—'}
      &lt;/button&gt;
      &lt;pre className="mt-4 bg-gray-100 p-4 rounded text-sm"&gt;{response}&lt;/pre&gt;
    &lt;/main&gt;
  );
}
</code></pre>

  <h2>âœ… PHPå´ã®ã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆbackend/backend1.phpï¼‰</h2>

  <pre><code>&lt;?php
// CORSï¼ˆã‚¯ãƒ­ã‚¹ã‚ªãƒªã‚¸ãƒ³ï¼‰å¯¾å¿œ
header('Access-Control-Allow-Origin: *');
header('Content-Type: application/json');

// ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
$response = [
  'message' =&gt; 'ã“ã‚“ã«ã¡ã¯ã€Next.jsã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã§ã™ï¼',
  'time' =&gt; date('Y-m-d H:i:s')
];

echo json_encode($response);
</code></pre>

  <h2>ğŸ”’ CORSå¯¾å¿œã«ã¤ã„ã¦</h2>
  <p>Next.jsã¨PHPã¯åˆ¥ãƒãƒ¼ãƒˆã§å‹•ã„ã¦ã„ã‚‹ãŸã‚ã€<code>fetch()</code>ã§é€šä¿¡ã™ã‚‹ã«ã¯PHPå´ã§ CORS ã‚’è¨±å¯ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚</p>
  <p><strong>é–‹ç™ºä¸­ã¯ <code>Access-Control-Allow-Origin: *</code> ã§OK</strong>ã§ã™ãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯è¨±å¯ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é™å®šã—ã¾ã—ã‚‡ã†ã€‚</p>

  <h2>ğŸ§ª å®Ÿè¡Œæ‰‹é †</h2>
  <ol>
    <li>Next.jså´ã§ <code>yarn dev</code> ã‚’å®Ÿè¡Œã—ã€<code>http://localhost:3000/dog</code> ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
    <li>ã€ŒPHPã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™</li>
    <li>PHPã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆJSONï¼‰ãŒç”»é¢ã«è¡¨ç¤ºã•ã‚Œã‚Œã°æˆåŠŸ</li>
  </ol>

  <h2>ğŸ’¡ å¿œç”¨ã®ãƒ’ãƒ³ãƒˆ</h2>
  <ul>
    <li>POSTãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹</li>
    <li>ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®é€ä¿¡å‡¦ç†ã«å¿œç”¨</li>
    <li>PHPã§DBã¨é€£æºã—ã€Next.jsã§çµæœè¡¨ç¤º</li>
  </ul>

</body>
</html>
