<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pythonの覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">
	<script src="/note_prg/js/jquery.min.js"></script>
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>Pythonの覚書 | ワクガンス</h1></div>
<div class="container">


<div id="sec3-1" class="sec4">
	<h3>WinPythonのコンソール | WinPythonにパッケージをインストール</h3>
	WinPython Command Prompt.exeがWinPythonのコンソールになっている。<br>
	このコンソールから各種パッケージをpipコマンドでインストールできる。<br>
	<br>
	
	（例）WinPython Command Prompt.exeの場所<br>
	<pre><code>C:\Users\user\python3_8\WPy64-3850\WinPython Command Prompt.exe</code></pre>
	<br>
	
	<img src="img/note3/sec3-1.png" class="img_compact_k" /><br>
	<br>
	
	<br><time>2021-9-1</time>
</div>


<div id="sec3-2" class="sec4" >
	<h3>WinPythonにOpenCVをインストール</h3>
	
	<ol class="list_lg">
		<li>
			WinPythonに含まれるツール「WinPython Command Prompt.exe」を起動してコンソールを起動する。
		</li>
		<li>
			OpenCVをpipコマンドでインストール
			<pre class="console">pip install opencv-python</pre>
		</li>
		<li>
			以上でインストール完了。
		</li>
		<li>
			インストールされているか確認<br>
			「python」コマンドを実行してPython実行モードにし、「import cv2」を実行。<br>
			エラーが表示されなければOK(何も出なければOK)。<br>
			<img src="img/note3/sec3-2.png" alt="" />
		</li>
		
	</ol>

	<br><time>2021-9-1</time>
</div>


<div id="sec3-3" class="sec4" >
	<h3>ffmegのインストール</h3>
	
	FFmpegは動画と音声を記録・変換・再生するためのフリーソフトウェアとのこと。
	GUIを持たず、コマンドラインから操作する。
	つまりプログラムに組み込んで使う。<br>
	<br>
	
	<ol class="list_lg">
		<li>
			2021年9月時点のダウンロード元。<br>
			<a href="https://ffmpeg.org/">https://ffmpeg.org/</a>からファイル群をダウンロードできる。<br>
			ffmpeg-N-103601-gb35653d4c4-win64-gpl-shared.zipをダウンロードする。<br>
			<img src="img/note3/sec3-3a1.png" class="img_compact_k" />
			<img src="img/note3/sec3-3a2.png" class="img_compact_k" />
		</li>
		
		<li>
			「ffmpeg-N-103601-gb35653d4c4-win64-gpl-shared.zip」を適当な解凍すると以下のファイル群を入手できる。<br>
			<br>
			ファイル群
			<pre>
avcodec-59.dll
avdevice-59.dll
avfilter-8.dll
avformat-59.dll
avutil-57.dll
ffmpeg.exe
ffplay.exe
ffprobe.exe
postproc-56.dll
swresample-4.dll
swscale-6.dll
			</pre>
		</li>
		
		<li>
			これらのファイル群をpyファイルの存在するディレクトリに丸ごと放り込む。<br>
			<aside>
				環境変数に設定する方法があるが、ファイルグ群を丸ごとプロジェクトに組み込む方法がいいかもしれない。<br>
			</aside>
			
			<pre>
avcodec-59.dll
avdevice-59.dll
avfilter-8.dll
avformat-59.dll
avutil-57.dll
ffmpeg.exe
ffplay.exe
ffprobe.exe
postproc-56.dll
<strong>sample.py</strong>
swresample-4.dll
swscale-6.dll
			</pre>
		</li>
		
		<li>
			WinPythonのコマンドラインツール「WinPython Command Prompt.exe」を開き、下記コマンドを実行し、ffmpegをインストール
			<pre class="console">pip install ffmpeg</pre>
			
			<p>例</p>
			<pre class="console">
C:\Users\user\WinPython\WPy64-3950\scripts>pip install ffmpeg
Collecting ffmpeg
  Downloading ffmpeg-1.4.tar.gz (5.1 kB)
Building wheels for collected packages: ffmpeg
  Building wheel for ffmpeg (setup.py) ... done
  Created wheel for ffmpeg: filename=ffmpeg-1.4-py3-none-any.whl size=6084 sha256=d1cc1d2b21681f13264aeca8d45c5680bf94ee42783affac7a7de2bd7bd8d7dd
  Stored in directory: c:\users\user\appdata\local\pip\cache\wheels\1d\57\24\4eff6a03a9ea0e647568e8a5a0546cdf957e3cf005372c0245
Successfully built ffmpeg
Installing collected packages: ffmpeg
Successfully installed ffmpeg-1.4
			</pre>
		</li>
		<li>
			pyファイル上でpydubなどffmpegを利用したパッケージのインストールし、それらが動作すれば成功。
			
		</li>
	</ol>


	<br><time>2021-9-13</time>
</div>


<div id="sec3-4" class="sec4" >
	<h3>pipのアップデート</h3>

	<pre class="console">pip install --upgrade pip --user</pre>

	<br><time>2021-9-15</time>
</div>


<div id="sec3-5" class="sec4" >
	<h3>設定データの読み込み | iniファイルなどから設定を読み込む | confg</h3>

	<p>main.py</p>
	<pre><code>
from ConfigX import ConfigX
print ('設定データの読み込み | iniファイルなどから設定を読み込む | confg')

configX = ConfigX()
confs =configX.getConfigs('./config.txt')
print(confs)
	</code></pre>
	
	<p>ConfigX</p>
	<pre><code>

# 設定データの取得
# auther kenji uehara
# version 1.0.0
# since 2021-11-5
class ConfigX:
    
    def getConfigs(self, text_fn):
        configs = {}
        
        # 設定ファイルを読み込み
        f = open(text_fn, 'r', encoding='UTF-8')
        text_all = f.read()
        f.close()
            
        lines = text_all.split('&yen;n')
        for line in lines:
            if ('=' in line) == False: continue
            field = self.__stringLeft(line, '=');
            field = field.strip()
            value = self.__stringRight(line, '=');
            value = value.strip()
            configs[field] = value
            
        return configs
    
    # 文字列を左側から印文字を検索し、左側の文字を切り出す
    # @param string s 対象文字列
    # @param $mark 印文字
    # @return 印文字から左側の文字列
    def __stringLeft(self, s, mark):
        a =s.find(mark)
        res = s[0:a]
        return res
    
    
    # 文字列を左側から印文字を検索し、右側の文字を切り出す。
    # @param string s 対象文字列
    # @param $mark 印文字
    # @return 印文字から右側の文字列
    def __stringRight(self, s, mark):
        a =s.find(mark)
        res = s[a+len(mark):]
        return res
        
	</code></pre>
	
	<p>config.txt</p>
	<pre>
#テスト設定ファイル
animal = neko
age = 16
power= https://amaraimusi.sakura.ne.jp/note_prg/a=123
	</pre>
	
	<p>出力</p>
	<pre class="console">
設定データの読み込み | iniファイルなどから設定を読み込む | conf
neko
16
https://amaraimusi.sakura.ne.jp/note_prg/a=123
{'animal': 'neko', 'age': '16', 'power': 'https://amaraimusi.sakura.ne.jp/note_prg/a=123'}

	</pre>

	<br><time>2021-11-5</time>
</div>


<div id="sec3-6" class="sec4">
	<h3>現在日時を取得 | datetime</h3>
	
	<pre><code>
import datetime

print ('Pythonの覚書：現在日時を取得 | datetime')

dt = datetime.datetime.now()
u = dt.strftime("%Y%m%d%H%M%S")
print(type(dt))
print(dt)
print(u)
	</code></pre>
	
	出力
	<pre class="console">
Pythonの覚書：datetime
&lt;class 'datetime.datetime'&gt;
2021-11-05 20:58:42.628284
20211105205842
	</pre>


	<br><time>2021-11-5</time>
</div>


<div id="sec3-7" class="sec4" >
	<h3>PythonでSQLite3を扱う</h3>
	
	<pre><code>
print ('PythonでSQLite3を扱う')

import sqlite3

# データベースにアクセス、データベースファイルが存在しなければ生成しつつアクセス
dao = sqlite3.connect(
    "test5.sqlite3", #データベースのファイル名
    isolation_level=None, #Noneは自動コミットを表す
)

sql = """
    CREATE TABLE nekos (
        id INTEGER PRIMARY KEY AUTOINCREMENT, 
        neko_name VARCHAR(50),
        neko_age INTEGER
    );
"""
dao.execute(sql)     #sql文を実行

dao.execute("INSERT INTO nekos(neko_name, neko_age) VALUES ('イッパイアッテナ', 12);")  

# SELECT文の実行とデータ取得
res = dao.execute("SELECT * FROM nekos;")  
#data = res.fetchone() # 1行だけ取得
data = res.fetchall() # すべての行を取得

print(data)

dao.close()
	</code></pre>


	<br><time>2021-12-23</time>
</div>


<div id="sec3-8" class="sec4" >
	<h3>クラスの基本的な書き方とfrom,importによるクラスの読込について</h3>
	
	ファイルとディレクトリの構成
	<pre>
	class_test.py(これをrunする)
	Animal(フォルダ)
		Dog.py
	</pre>
	
	class_test.py
	<pre><code>
from Animal.Dog import Dog # from フォルダ.クラスファイル名 import クラス名

	batta = Dog()
	batta.bark('臆病な犬')
	</code></pre>
	Dog.py
	<pre><code>
class Dog:
    
    # コンストラクタ
    def __init__(self):
        print('犬のコンストラクタ')
        self.type_a = 'xxx' # publicメンバ
        self.__type_b = '犬科' # privateメンバ

    # publicメソッド
    def bark(self, animal_name):
        print(f'{animal_name}がほえる')
        print(self.type_a) # メンバにアクセス
        print(self.__type_b)
        print(self.__work()) # 同クラス内のメソッドの呼び出し
        
    # privateメソッド
    def __work(self):
        print('犬もあるけば棒にあたる')
	</code></pre>
	
	出力
	<pre class="console">
犬のコンストラクタ
哺乳類A
犬科
臆病な犬がほえる
犬もあるけば棒にあたる
	</pre>
	<hr>


	<h4>ディレクトリの階層が深い場合のインポート</h4>
	ファイルとディレクトリの構成
	<pre>
	class_test.py(これをrunする)
	Animal(フォルダ)
		Insect(フォルダ)
			Batta.py
	</pre>
	
	class_test.py
	<pre><code>
	from Animal.Insect.Batta import Batta
	
	batta = Batta()
	batta.jump('オンブバッタ')
	</code></pre>
	<pre><code>
	class Batta:
	    def __init__(self):
	        print('バッタのコンストラクタ')
	
	    def jump(self, animal_name):
	        print(f'{animal_name}が跳ねる')
	</code></pre>
	<hr>
	
	<br><time>2021-12-30</time>
</div>


<div id="sec3-9" class="sec4" >
	<h3>外部のディレクトリにあるクラスをimportする | 絶対パスを指定してクラスをインポート</h3>
	
	<pre><code>
import sys
sys.path.append("C:\\Users\\user\\git\\python_sample\\a001\\Animal\\Insect\\")
from Batta import Batta # from クラスファイル名 import クラス名

bata = Batta()
bata.jump('トノサマバッタ')
	</code></pre>
	
	C:\Users\user\git\python_sample\a001\Animal\Insect\Batta.py
	<pre><code>
class Batta:
    def __init__(self):
        print('バッタのコンストラクタ')

    def jump(self, animal_name):
        print(f'{animal_name}が跳ねる')
	</code></pre>

	<br><time>2021-12-30</time>
</div>


<div id="sec3-10" class="sec4" >
	<h3>空の変数の宣言→value1 = None</h3>
	whileやifなど空の変数を宣言せねばならないときに。もちろんオブジェクト型、プリミティブ型のどちらにも対応。
	<pre><code>
	value1 = None
	</code></pre>

	<br><time>2022-1-4</time>
</div>


<div id="sec3-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time>2021-11-5</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/python/">Pythonの覚書</a></li>
</ol>
</div><!-- content -->
<div id="footer">(C) kenji uehara 2021-9-1</div>
</body>
</html>