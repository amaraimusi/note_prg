<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Seleniumの覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">
	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>Seleniumの覚書 | ワクガンス</h1></div>
<div class="container">


<div id="sec2-1" class="sec4">
	<h3>Seleniumについて（2020年、Windows10環境）</h3>
	
	Seleniumはオートメーションツールと呼ばれるものでブラウザを自動操作できる。<br>
	テストで使われる他、スクレイピングでも活躍する。<br>
	「Selenium RC」と「Selenium WebDriver」が存在し、2020年現在は「Selenium WebDriver」が使われる。<br>
	<br>
	
	<p>Selenium RC</p>
	JavaScriptのコードを対象のページに埋め込んでブラウザを自動操作する。まだ使えるようだが非推奨という扱いになっている。<br>
	<br>
	
	<p>Selenium WebDriver</p>
	2020年の時点ではこちらの「Selenium」が使われる。ブラウザの拡張機能やOSのネイティブ機能などを利用してブラウザを自動操作する。<br>
	SeleniumというとChromeが思い浮かぶが、FireFox版、IE版なども存在するようだ。<br>
	ブラウザの操作コマンドにはPython, Java, ruby、node.jsなどのプログラミング言語が使われる。<br>
	<br>
	
	<p>ChromeでSeleniumを使うには？</p>
	ChromeでSeleniumを使うにはChromeDriverが必要とのこと。<br>
	Windows10にChromeDriverをインストールする場合、バージョン合わせや環境編集指定が必要なのでやや面倒ではある。→
	<a href="https://www.mittsu-kosen.com/chromedriver%E3%82%92windows10%E3%81%A7%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E6%96%B9%E6%B3%95%E3%80%90%E7%94%BB%E5%83%8F%E4%BB%98%E3%81%8D%E3%80%91/">参考</a><br>
	本格的な自動操作システムを構築したい場合はWindowsよりもLinuxが向いている。<br>
	<br>

	<p>ChromeDriverとは？</p>
	Chrome用のWebDriver。<br>
	Android上のChromeとデスクトップ上のChrome（Mac、Linux、Windows、ChromeOS）で利用できる。<br>
	<br>
	
	<p>WebDriverとは？</p>
	WebDriverは、多くのブラウザでWebアプリを外部から操作するためのオープンソースツール。<br>
	Webページへの移動、ユーザー入力、JavaScriptの実行などの機能を提供する。<br>
	W3Cが策定した標準機能らしい。そのためChromeにかぎらず、主要なブラウザでは一通り実装されている。<br>
	<br>
	
	<p>まとめ</p>
	Windows10環境である場合、Chrome, ChromeDriver, Selenium, Python3を組み合わせて自動操作システムを構築するようだ。<br>
	<br>


	<br><time>2020-1-13</time>
</div>


<div id="sec2-2" class="sec4" >
	<h3>WinpythonにSeleniumをインストール</h3>
	
	「IPython Qt Console.exe」を実行するとWinpythonのコンソールを立ち上がる。（少し遅い）
	コンソールにSeleniumインストールコマンドを入力するだけ。
	<pre>$ pip install selenium</pre>
	<br>
	
	<img src="img/selenium_note2/sec2-2a1.png" class="img_compact_k" />

	<br><time>2020-1-13</time>
</div>


<div id="sec2-3" class="sec4" >
	<h3>Seleniumの基本</h3>
	
	
	python + Chrome + ChromeDriver + Seleniumの組み合わせでスクレイピングを行う。<br>
	pythonはWinPythonを用いる。<br>
	<a href="/note_prg/python/note1.html#sec1-1" class="livipage">参考：winPythonの入手</a><br>
	<br>
			
	<p>Seleniumを実行するまでの手順</p>
	<ol class="list_lg">
	
		<li>
			Winpythonのコンソールを立ち上げ、Seleniumをインストールする。<br>
			Winpythonパッケージに存在する「IPython Qt Console.exe」を実行するとコンソールが立ち上がる。<br>
			<pre>$ pip install selenium</pre>
			<a href="#sec2-2" class="livipage">参考：WinpythonにSeleniumをインストール</a><br>
			<br>
		</li>
		
		<li>
			Chromeを開き、Chromeのバージョンを確認する。<br>
			<img src="img/selenium_note2/sec2-3a1.png" class="img_compact_k" />
		</li>
		
		<li>
			ChromeDriverをダウンロードする。複数のダウンロードリンクが存在するが、Chromeのバージョンに近いものを選ぶ。<br>
			<a href="https://chromedriver.chromium.org/downloads" target="blank">https://chromedriver.chromium.org/downloads</a><br>
			<br>
			<img src="img/selenium_note2/sec2-3a2.png" class="img_compact_k" />
		</li>
		
		<li>
			ダウンロードしたものを展開して「chromedriver.exe」を入手。
		</li>
		
		<li>
			パス指定するので「chromedriver.exe」はどこに配置しても良い。<br>
			今回は、pythonのプロジェクトを作成したので、その中にlibディレクトリを作成してchromedriver.exeを配置した。<br>
			<br>
			<img src="img/selenium_note2/sec2-3a4.png" /><br>
			<br>
		</li>

		<li>
			
			"Googleを開き「赤猫」ワードで検索”、という流れを自動操作するソースコード。<br>
			<br>
			test.py
			<pre><code>
import time
from selenium import webdriver

driver = webdriver.Chrome(executable_path='lib&yen;&yen;chromedriver.exe')
driver.get('https://www.google.com/')
time.sleep(5)
search_box = driver.find_element_by_name("q")
search_box.send_keys('赤猫')
search_box.submit()
time.sleep(5)
driver.quit()
			</code></pre>
			<aside>
			上記のソースコードではchromedriver.exeを相対パス指定しているが、環境変数にしたり、
			「C:\Users\user\git\selenium_scraping_demo\lib\chromedriver.exe」のようにフルパス指定でもOK。
			</aside>
		</li>
		
		<li>
			test.pyを実行すると、Chromeが立ち上がり、自動で動き出す。<br>
			<img src="img/selenium_note2/sec2-3a5.png" class="img_compact_k" />
		</li>
		
		<li>終わり</li>
	</ol>
	


	<br><time>2020-10-18</time>
</div>


<div id="sec2-4" class="sec4" >
	<h3>よく使うメソッド</h3>
	
	
	<table class="tbl2">
		<thead><tr><th>メソッド</th><th>説明</th></tr></thead>
		<tbody>
			<tr>
				<td>
					elm = driver.find_element_by_id("neko1") 
				</td>
				<td>
					IDを指定して要素を取得する。<br>
					JavaScriptにより<strong>動的</strong>に追加された要素も取得可能。
					<pre><code>&lt;input id="neko1" type="text" value="" &gt;</code></pre>
				</td>
			</tr>
			<tr>
				<td>
					elm.submit()
				</td>
				<td>
					Submitボタンを自動押下。<br>
					elm（要素）はsubmitボタン要素である必要はなく、form内のいずれかのinput要素でもよい。
				</td>
			</tr>
			<tr>
				<td>
					elm = find_element_by_name('要素のname属性')
				</td>
				<td>
					name属性を指定して要素を取得する。
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_xpath("//input[@name='neko_memo'][@type='text']")
				</td>
				<td>
					jQueryのようなセレクタ指定方式で要素を取得する。<br>
					最初に見つかった要素を一つ取得する。
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_link_text('Wikipedia')
				</td>
				<td>
					a要素のリンクテキストを指定して要素を取得する。<br>
					<pre><code>&lt;a href="https://ja.wikipedia.org/"&gt;Wikipedia&lt;/a&gt;</code></pre>
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_partial_link_text('Wiki')
				</td>
				<td>
					a要素のリンクテキストを部分一致検索して要素を取得する
					<pre><code>&lt;a href="https://ja.wikipedia.org/"&gt;Wikipedia&lt;/a&gt;</code></pre>
					<aside>
						検索文字がリンクテキストに一部でも含まれていれば取得される。<br>
						find_element_by_partial_link_text('<strong>iki</strong>')
					</aside>
				</td>
			</tr>
			<tr>
				<td>
					elm.click()
				</td>
				<td>
					find_element_by_link_textで取得したa要素で「elm.click()」を実行すると、ハイパーリンク先のページに移動する。<br>
					また、ボタン要素で「elm.click()」を実行すると、ボタン自動押下を行い、JavaScriptのonclickイベントを発動させることができる。
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_tag_name("input") 
				</td>
				<td>
					タグ名で最初に見つかった要素を取得する。<br>
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_class_name("neko_class") 
				</td>
				<td>
					class属性名そ指定して最初に見つかった要素を取得する。<br>
				</td>
			</tr>
			<tr>
				<td>
					elm = driver.find_element_by_css_selector('input.neko_class')
				</td>
				<td>
					<a href="#sec2-6" class="livipage" >参照：セレクタ：find_element_by_css_selector</a>
				</td>
			</tr>
			
		</tbody>
	</table>


	<br><time>2020-1-19</time>
</div>


<div id="sec2-5" class="sec4">
	<h3>SeleniumはJavaScriptにより動的に生成した要素も自動操作できる。</h3>
	
	HTML
	<pre><code>
	&lt;div&gt;
		&lt;script&gt;
		function clickBtn1(){
			let html = `
				&lt;input id='btn2' type='button' value='テストボタン2' onclick='clickBtn2()' /&gt;
			`;
			jQuery('#div1').html(html);
		}
		function clickBtn2(){
			alert('ボタン２をクリックしました。');
		}
		&lt;/script&gt;
		&lt;input id="btn1" type="button" value="テストボタン" onclick="clickBtn1()"/&gt;
		&lt;div id="div1"&gt;&lt;/div&gt;
	&lt;/div&gt;
	</code></pre><br>
	
	Python
	<pre><code>
	import time
	from selenium import webdriver
	
	driver = webdriver.Chrome(executable_path='lib\\chromedriver.exe')
	driver.get('http://localhost/selenium_scraping_demo/web_app_test/test1.php')
	time.sleep(3)
	elm = driver.find_element_by_id("btn1") 
	elm.click()
	time.sleep(1)
	elm = driver.find_element_by_id("btn2") 
	elm.click()
	</code></pre>


	<br><time>2020-10-19</time>
</div>


<div id="sec2-6" class="sec4" >
	<h3>セレクタ：find_element_by_css_selector</h3>
	
	<p>ケース1</p>
	HTML
	<pre><code>&lt;input id="neko1" type="text"  class="neko_class" value="" &gt;</code></pre>
	Python
	<pre><code>elm = driver.find_element_by_css_selector('input.neko_class')</code></pre>
	<hr>
	
	<p>ケース2</p>
	HTML
	<pre><code>
	&lt;div data-id="101"&gt;
		&lt;input id="neko1" type="text" name="neko_name" class="neko_class" value="新入りの帽子猫" &gt;
	&lt;/div&gt;
	</code></pre>
	Python
	<pre><code>elm = driver.find_element_by_css_selector('div[data-id="101"] &gt; input')</code></pre>
	<hr>
	
	<p>ケース3</p>
	HTML
	<pre><code>&lt;input id="neko1" type="text" value="" &gt;</code></pre>
	Python
	<pre><code>elm = driver.find_element_by_css_selector('input#neko1')</code></pre>
	<hr>
	
	<p>ケース4</p>
	HTML
	<pre><code>&lt;input id="neko1" type="text" name="neko_name" class="neko_class" value="" &gt;</code></pre>
	Python
	<pre><code>elm = driver.find_element_by_css_selector('input.neko_class#neko1[name="neko_name"]')</code></pre>
	<hr>


	<br><time>2020-10-20</time>
</div>


<div id="sec2-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time>2020-1-1</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/selenium/">Seleniumの覚書</a></li>
</ol>

</div><!-- content -->
<div id="footer">(C) kenji uehara 2020-1-13</div>
</body>
</html>