<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Laravel9の覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap-4.3.1-dist/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">
	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/popper.js"></script><!-- ポップアップ機能およびBootstrapの補助ライブラリ -->
	<script src="/note_prg/js/bootstrap-4.3.1-dist/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>Laravel9の覚書 | ワクガンス</h1></div>
<div class="container">


<div id="sec3-1" class="sec4" >
	<h3>WHERE条件 「IS NOT NULL」と「IS NULL」</h3>
	
	<pre><code>
	$query = DB::table('sales');
	$query = $query->whereNotNull('sales.deleted_at'); // IS NOT NULL
	$query = $query->whereNull('sales.deleted_at'); // IS NULL
	</code></pre>
	<br>
	
	空の取得はこちらのほうが汎用的だ。
	<pre><code>
	$query = $query->whereRaw("(deleted_at IS NULL OR deleted_at = 0 OR deleted_at = '')");
	</code></pre>


	<br><time>2022-12-29</time>
</div>


<div id="sec3-2" class="sec4" >
	<h3>bladeのラジオボタン</h3>
	
	<pre>
			&lt;div class="d-inline-block mx-4"&gt;
				&lt;div class="form-check d-inline-block"&gt;
					&lt;input class="form-check-input" type="radio" name="deleted_at" id="deleted_at1" value="0"  @checked(old('deleted_at', $searches['deleted_at']) == 0) &gt;
					&lt;label class="form-check-label" for="deleted_at1"&gt;有効&lt;/label&gt;
				&lt;/div&gt;
				&lt;div class="form-check d-inline-block" &gt;
					&lt;input class="form-check-input" type="radio" name="deleted_at" id="deleted_at2" value="1"  @checked(old('deleted_at', $searches['deleted_at']) == 1) &gt;
					&lt;label class="form-check-label" for="deleted_at2"&gt;無効(削除)&lt;/label&gt;
				&lt;/div&gt;
			&lt;/div&gt;
	</pre>


	<br><time>2023-1-4</time>
</div>


<div id="sec3-3" class="sec4" >
    <h3>DBからレコードを削除する | delete | destroy</h3>

    <pre><code>
    $id = 999;
    \DB::table('animals')->where('id', $id)->delete();
    </code></pre>
    
    <p>destroyメソッドはなぜか効かなくなったので中尉</p>
    <pre><code>
    $id = 999;
    Animal::destroy($id);
    </code></pre>

    <br><time>2023-1-12</time>
</div>


<div id="sec3-4" class="sec4" >
    <h3>Laravelのfetch | SPA</h3>
    
    <p>JavaScript</p>
    <pre><code>
    
    let fd = new FormData(); // 送信フォームデータ
    let data = {id:123, name:'古いねこ', age:15}; // バックエンド側に送信するデータ
    let json = JSON.stringify(data);
    fd.append( "key1", json );
    
    // CSRFトークンを送信フォームデータにセットする。
    let token = jQuery('#csrf_token').val();
    fd.append( "_token", token );

    fetch('neko/reg_action', {
        method: 'POST',
        body: fd,
    })
    .then(response => {
        console.log('fetchの成功時に、サーバーから返されたレスポンスをJSON形式に変換するための処理');//■■■□□□■■■□□□
        return response.text()
            .then(text => {
                try {
                    return JSON.parse(text);
                } catch (e) {
                    this.jqErr.html(`<strong>バックエンド側でエラーが起きました。</strong><br>${text}`);
                }
            });
    })
    .then(data => {
        console.log('response後の処理。こちらに諸処理を記述します。');//■■■□□□■■■□□□
        console.log(data);//■■■□□□■■■□□□

    })
    .catch(error => {
        
        console.error(error);
        alert('通信エラー');
        
    });
    </code></pre>
    
    <p>バックエンド</p>
    
    とあるコントローラのアクションメソッド。
    
    <pre><code>
    /**
     * SPA型・入力フォームの登録アクション
     * @return string
     */
    public function regAction(){
        
        // ログアウトになっていたらログイン画面にリダイレクト
        if(\Auth::id() == null) return redirect('login');
        
        $json=$_POST['key1'];
        $res = json_decode($json, true);
        $res['name'] = '新しい猫';
        $res['age'] = 1;
        $res['date'] = '2020-7-23';
        
        $json = json_encode($res, JSON_HEX_TAG | JSON_HEX_QUOT | JSON_HEX_AMP | JSON_HEX_APOS);
        
        return $json;
    }
    </code></pre>
    
    <p>web.php</p>
    <pre><code>
    Route::post('neko/reg_action', 'App\Http\Controllers\NekoController@regAction');
    </code></pre>
    


    <br><time>2023-4-25 | 2023-5-4</time>
</div>


<div id="sec3-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time>2022-12-29</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/laravel/">Laravelの覚書</a></li>
	<li>Laravel9の覚書</li>
</ol>

</div><!-- content -->
<div id="footer">(C) amaraimusi 2022-12-29</div>
</body>
</html>