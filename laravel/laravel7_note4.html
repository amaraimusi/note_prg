<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Laravel7の覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">
	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/vue.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>Laravel7の覚書 | ワクガンス</h1></div>
<div class="container">



<div id="sec4-1" class="sec4"  >
	<h3>SQLを直接実行</h3>

	<p>SELECT系のSQLを直接実行</p>
	<pre><code>$data = \DB::select('select * from nekos where id= 4');</code></pre>
	レスポンスはエンティティの配列となる。<br>
	<br>
	
	<p>SELECT系のSQLを安全に実行</p>
	<pre><code>$data = \DB::select('select * from nekos where id = :id', ['id' => 4]);</code></pre>
	この方法は値はサニタイズされるようなのでセーフティなコーディングと言える。<br>
	<br>
	
	<p>selectメソッドは一応どんなSQLでも実行可能。</p>
	selectメソッドはSELECT文専用ではない。UPDATEなど他のSQLも実行できる。
	つまり、selectメソッドは生のSQLを何でも実行できるメソッドである。
	ちなみにUPDATEなどのSQLを実行したときのレスポンスは空配列「[]」になる。<br>
	
	一応、下記のような使い方も可能である。
	<pre><code>$data = \DB::select("UPDATE `nekos` SET `neko_val`=2000,`neko_name`='シャム猫' WHERE id=4");</code></pre>
	<br>
	
	<p>INSERTを直接実行</p>
	<pre><code>$res = \DB::insert("INSERT INTO `nekos`(`neko_val`, `neko_name`) VALUES (1001, 'ホンハブ')");</code></pre>
	レスポンスはbool型のtrue。
	<br>
	
	<p>INSERTを安全に実行</p>
	<pre><code>$res = \DB::insert("INSERT INTO `nekos`(`neko_val`, `neko_name`) VALUES (?, ?)", [1002, 'ヒメハブ']);</code></pre>
	<br>
	
	<p>UPDATEを直接実行</p>
	<pre><code>$res = \DB::update("UPDATE `nekos` SET `neko_val`=100,`neko_name`='黒猫' WHERE id=4");</code></pre>
	<br>
	
	<p>UPDATEを安全に実行</p>
	<pre><code>$res = \DB::update("UPDATE `nekos` SET `neko_val`=?,`neko_name`=? WHERE id=?", [101,'白猫',5]);</code></pre>
	<br>
	
	<p>DELETE</p>
	<pre><code>$res = \DB::delete('delete from nekos where neko_name = ?', ['マンチカン']);</code></pre>
	<br>
	
	<p>レスポンスを必要としないSQLの実行</p>
	<pre><code>$res = \DB::statement('ALTER TABLE nekos auto_increment = 1;');</code></pre>
	<aside>※ 例：オートインクリメントをリセットするSQL</aside>
	レスポンスはbool型のtrueが返ってくる。<br>
	<br>
	

	<br><time>2020-7-3</time>
</div>



<div id="sec4-2" class="sec4"  >
	<h3>Laravelのトランザクション</h3>

	<pre><code>\DB::beginTransaction();</code></pre>
	<pre><code>\DB::commit();</code></pre>
	<pre><code>\DB::rollback();</code></pre>

	<br><time>2020-7-3</time>
</div>



<div id="sec4-3" class="sec4" >
	<h3>ユーザー情報を取得する | ユーザーID,ユーザー名,メールアドレスなどを取得する</h3>
	
	<pre><code>
	if(\Auth::id()){// idは未ログインである場合、nullになる。
		$user_id = \Auth::id(); // ユーザーID（番号）
		$user_name = \Auth::user()->name; // ユーザー名
		$user_email = \Auth::user()->email; // メールアドレス
		$user_password_hash = \Auth::user()->password; // ハッシュ化（解読不可）されたパスワード
		
	}
	</code></pre>


	<br><time>2020-7-7</time>
</div>



<div id="sec4-4" class="sec4" >
	<h3>ログイン画面を作成</h3>
		Laravel6および7でのログイン画面作成方法


	<ol class="list_lg">
		<li>
			下記のコマンドを実行する。（動くまで時間がかかる）
			<pre>composer require laravel/ui --dev</pre>
			<aside>「laravel/ui」はBootstrapなどデザイン回りの処理が関係しているようだ</aside>
			<img src="img/laravel7_note4/sec4-4a1.png" />
		</li>
		
		<li>
			下記のコマンドを実行し、ログイン画面関連のファイルを自動作成する。
			<pre>php artisan ui vue --auth</pre>
			<aside>※先にマイグレーションを実行してDBにusersテーブルを自動生成して置く必要があるかもしれない。</aside>
			<img src="img/laravel7_note4/sec4-4a2.png" class="img_compact_k" />
		</li>
		
		<li>
			URL「～ルート～/public/home」にアクセスするとログイン画面になる。<br>
			例：<pre>http://localhost/animal/public/</pre>
			<img src="img/laravel7_note4/sec4-4a3.png" class="img_compact_k" />
			<img src="img/laravel7_note4/sec4-4a4.png" class="img_compact_k" />
		</li>
		
		<li>
			初期状態のwelcomeページにログイン関連のリンクが表示されるようになっている。
			<aside>welcomeページ「～ルート～/public/」</aside>
			<img src="img/laravel7_note4/sec4-4a5.png" class="img_compact_k" />
			<img src="img/laravel7_note4/sec4-4a6.png" class="img_compact_k" />
		</li>
		
	</ol>

	<p>注意</p>
	Laravel7では「php artisan make:auth」コマンドが使えなくなっている。<br>
	<img src="img/laravel7_note4/sec4-4a7.png" class="img_compact_k" /><br>
	<br>

	<br><time>2020-7-7</time>
</div>



<div id="sec4-0" class="sec4"  style="display:none">
	<h3>xxx</h3>


	<br><time>2020-7-7</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/js/">JavaScriptの覚書</a></li>
	<li>Laravel7の覚書</li>
</ol>
</div><!-- content -->
<div id="footer">(C) kenji uehara 2020-7-3</div>
</body>
</html>