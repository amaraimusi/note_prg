<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PHPの覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/jquery-ui.min.css" rel="stylesheet">
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">

	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/jquery-ui.min.js"></script>
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>PHPの覚書 | ワクガンス</h1></div>
<div class="container">




<div id="sec15-1" class="sec4">
	<h3>ImageMagickの旧覚書</h3>

	<pre><code>

	■概要
	　ImageMagickを使うと、サイズを変えたサムネイル画像を作成したり、形式（拡張子）が異なる画像に変換できる。（TIF→PNGなど）
	　ImageMagickはサーバー側にインストールされている。さくらサーバーにもインストールされているが、perl専用のため、専用クラス（imagemagickクラス）が利用できない。しかしsystem関数によるコマンド型で、利用することができる。
	　ImageMagickはVBやC++などからも利用できる。おそらくJavaでも・・
	
	■設定手順
	
	1.ImageMagickを以下のサイトからダウンロードする。
		ダウンロードサイト：http://imagemagick.org/script/binary-releases.php#windows
		いくつか種類があるが、初回はImageMagick-6.7.4-7-Q8-windows-dll.exeを入手
	
	2.ImageMagickをインストールする。
		ImageMagick-6.7.4-7-Q8-windows-dll.exeを実行し、ウィザードに従ってゆく。途中perl用,C++用などの選択があるが、とりあえずperl用にチェックを入れておけばよい。（チェックなしでも問題ない可能性もある）
	
	3.PC再起動
		環境パスへ設定されると思われる。
	
	4.PHP用拡張ライブラリをダウンロード
		ダウンロードサイト：http://valokuva.org/outside-blog-content/imagick-windows-builds/080709/
		拡張ライブラリはいくつか種類があるが、とりあえず、環境によりどれが動作するか不明のため、すべて入手。
		拡張ライブラリにはphp_imagick_dyn-Q16.dll、	php_imagick_st-Q16.dllなどがある。
	
	5.PHP用拡張ライブラリをPHPディレクトリの指定場所に配置する。
		配置場所の例としてC:&yen;web&yen;PHP&yen;ext
	
	6.php.iniに設定を追加
	以下の記述を追加する。
		extension_dir = "C:&yen;web&yen;PHP&yen;ext"
		extension=php_imagick_st-Q16.dll
		
		extension_dirはextディレクトリを有効にするための設定かと思われる。extディレクトリはデフォルトでは存在しないため。ImageMagickとは無関係のライブラリでも利用する場合があるので、既存がないか要確認。
		extensionには、上記でダウンロードした、拡張ライブラリ名を指定。複数の拡張ライブラリをダウンロードしたが、そのうち動作する拡張ライブラリの名前を指定。動作確認はApacheの再起動で確認できる。動作不能な拡張ライブラリの場合、エラーがでて再起動に失敗する。
		Apacheを再起動を忘れずに。
	
	■サンプルコード（クラス利用型）
	&lt;?
	$im = new imagick( '../files/023.TIF' );
	$im-&gt;thumbnailImage( 200, 0);
	$im-&gt;writeImage( '../files/023.png' );
	
	echo "test003 success!!";
	?&gt;
	■サンプルコード２（system関数利用型）
	&lt;?
	system("convert -geometry 20% 023.TIF 023.png");
	echo "success!!";
	?&gt;
	
	※convertコマンドの使い方
	http://www.envinfo.uee.kyoto-u.ac.jp/user/susaki/image/magick_process.html
	
	■参考サイト
	http://www.elxsy.com/2009/07/installing-imagemagick-on-windows-and-using-with-php-imagick/
	http://q.hatena.ne.jp/1101107667
	http://blog.quall.net/linuxserver/505/
	</code></pre>

	<br><time>2012-1-17</time>
</div>




<div id="sec15-2" class="sec4" >
	<h3>ページネーション</h3>
	
	<a href="/sample/php/a040/pagenation/pagenation.php" class="btn btn-info">デモ</a><br>
	<br>
	
	<pre><code>
	&lt;?php 
	
	$page_no = 0;
	if(!empty($_GET['page_no'])){
		$page_no = $_GET['page_no'];
	}
	
	$base_url = "/sample/php/a040/pagenation/pagenation.php";
	$all_data_cnt = 100;
	$row_limit = 10;
	$midasi_cnt = 5;
	$params = ['a' =&gt; 'neko' , 'b' =&gt; 'buta'];
	
	
	$res = createpagenationHtml($base_url, $page_no, $all_data_cnt, $row_limit, $midasi_cnt, $params);
	
	echo $res['mokuji'];
	
	/**
	 * ページネーション用の目次HTMLを作成する
	 * @param int $page_no	現在のページ番号（0から開始）
	 * @param int $all_data_cnt 全データ数
	 * @param int $row_limit 行制限数(LIMIT)
	 * @param int $midasi_cnt 表示するペースの数
	 * @param array $params リンクのURLに付加するパラメータ（キー、値）
	 * @param array $option
	 *  - page_field ページフィールド名： def→ page_no
	 * @return array ページネーションデータ
	 */
	function createpagenationHtml($base_url, $page_no, $all_data_cnt, $row_limit, $midasi_cnt, $params, $option = array()){
		
		// ページネーションデータ
		$pagenationData = array(
				'mokuji'=&gt;'', // 目次HTML
				'page_prev_link'=&gt;'',
				'page_next_link'=&gt;'',
				'page_top_link'=&gt;'',
				'page_last_link'=&gt;'',
				'query_str'=&gt;'',
				'base_url' =&gt; $base_url,
				'page_no' =&gt; $page_no,
				'all_data_cnt' =&gt; $all_data_cnt,
				'row_limit' =&gt; $row_limit,
				'midasi_cnt' =&gt; $midasi_cnt,
		);
		if($all_data_cnt == 0) return $pagenationData;
		if(empty($row_limit)) return $pagenationData;
		
		// オプションの初期化
		if(empty($option['page_field'])) $option['page_field'] ='page_no';
		
		$page_field = $option['page_field'];
		
		
		//▼ページネーションを構成する総リンク数をカウントする。
		$allMdCnt = ceil($all_data_cnt / $row_limit);
		$md2 = $allMdCnt;
		if($md2 &gt; $midasi_cnt){
			$md2 = $midasi_cnt;
		}
		$linkCnt =4 + $md2;
		
		//▼最終ページ番号を取得
		if($md2 &gt; 0){
			$lastPageNo = $allMdCnt-1;
		}
		
		$strParams='';
		if(!empty($params)){
			//▼その他パラメータコードを作成する。
			foreach($params as $key=&gt;$val){
				if($val !== null &amp;&amp; $val !== '')
					$strParams = $strParams.'&amp;'.$key.'='.$val;
			}
		}
		
		//▼最戻リンクを作成
		$page_top_link = '';
		$rtnMax = '&amp;lt&amp;lt';
		if($page_no &gt; 0){
			$url = "{$base_url}?{$page_field}=0{$strParams}";
			$page_top_link = $url;
			$rtnMax="&lt;a href='{$url}'&gt;{$rtnMax}&lt;/a&gt;";
		}
		
		//▼単戻リンクを作成
		$rtn1='&amp;lt';
		$page_prev_link = '';
		if($page_no &gt; 0){
			$p=$page_no - 1;
			$url = "{$base_url}?{$page_field}={$p}{$strParams}";
			$page_prev_link = $url;
			$rtn1 = "&lt;a href='{$url}'&gt;{$rtn1}&lt;/a&gt;";
		}
		
		//▼単進リンクを作成
		$page_next_link = '';
		$next1='&amp;gt';
		if($page_no &lt; $lastPageNo){
			$p=$page_no + 1;
			$url = "{$base_url}?{$page_field}={$p}{$strParams}";
			$page_next_link = $url;
			$next1 = "&lt;a href='{$url}'&gt;{$next1}&lt;/a&gt;";
		}
		
		//▼最進リンクを作成
		$page_last_link = '';
		$nextMax='&amp;gt&amp;gt';
		if($page_no &lt; $lastPageNo){
			$p=$lastPageNo;
			$url = "{$base_url}?{$page_field}={$p}{$strParams}";
			$page_last_link = $url;
			$nextMax="&lt;a href='$url'&gt;{$nextMax}&lt;/a&gt;";
		}
		
		//▼見出し配列を作成
		$fno=$lastPageNo - $md2 + 1;
		if($page_no &lt; $fno){
			$fno=$page_no;
		}
		$lno = $fno + $md2 - 1;
		
		for($i = $fno; $i &lt;= $lno; $i++){
			$pn=$i+1;
			if($i!=$page_no){
				$url = "{$base_url}?{$page_field}={$i}{$strParams}";
				$midasiList[]="&lt;a href='$url'&gt;{$pn}&lt;/a&gt;";
			}else{
				$midasiList[]=$pn;
			}
		}
		
		//▼HTML組み立て
		$html = "&lt;div id='page_index'&gt;";
		$html .= "{$rtnMax}&amp;nbsp;&yen;n";
		$html .= "{$rtn1}&amp;nbsp;&yen;n";
		foreach($midasiList as $key=&gt;$val){
			$html .= "{$val}&amp;nbsp;&yen;n";
		}
		$html .= "{$next1}&amp;nbsp;&yen;n";
		$html .= "{$nextMax}&amp;nbsp;&yen;n";
		$html .= "&lt;/div&gt;&yen;n";
		
		// クエリ文字列
		$query_str = "{$page_field}=0{$strParams}";
		
		$pagenationData['mokuji'] = $html;
		$pagenationData['page_prev_link'] = $page_prev_link;
		$pagenationData['page_next_link'] = $page_next_link;
		$pagenationData['page_top_link'] = $page_top_link;
		$pagenationData['page_last_link'] = $page_last_link;
		$pagenationData['query_str'] = $query_str;
	
		return $pagenationData;
	}
	
	?&gt;
	</code></pre>


	<br><time>2018-11-16</time>
</div>




<div id="sec15-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time></time>
</div>




<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/php/">PHPの覚書</a></li>
</ol>

</div><!-- content -->
<div id="footer">(C) kenji uehara 2012-1-17 | 2018-10-15</div>
</body>
</html>