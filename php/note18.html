<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PHPの覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">
	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>PHPの覚書 | ワクガンス</h1></div>
<div class="container">


<div id="sec18-1" class="sec4">
	<h3>自作ログイン | 基本</h3>
	
	<a href="/sample/php/a060/original_login/" class="btn btn-info">Demo</a><br>
	<br>
	
	demo1.php
	<pre><code>
	&lt;?php 
	if(!empty($_POST['login_submit'])){
		$pw_hash2 = getTestPwHash($_POST['uid']);
			if(password_verify($_POST['password'], $pw_hash2)){
				print 'ログイン成功';
			}else{
				print 'ログイン失敗';
			}
	}
	
	function getTestPwHash($uid){
		// 本来は、DBからユーザーIDにひもづくパスワードハッシュを取得処理である。
		// テスト用にパスワードハッシュを直に記述している。
		$pw='hogehoge'; // テストパスワード
		$pw_hash = password_hash($pw, PASSWORD_DEFAULT);
		return $pw_hash;
	}
	?&gt;
	&lt;form action="#" method="post"&gt;
		&lt;input name="uid" type="text" /&gt;&lt;br&gt;
		&lt;input name="password" type="password" /&gt;テスト用パスワード→hogehoge&lt;br&gt;&lt;br&gt;
		&lt;input type="submit" name="login_submit" value="Login" class="btn btn-primary"/&gt;
	&lt;/form&gt;
	</code></pre>

	<a href="https://blog.apar.jp/php/12373/" target="blank">参考サイト：あぱーブログ：PHP のセッションを使ったログイン認証はなぜ安全なのか？</a><br>
	<br>

	<br><time>2020-3-8</time>
</div>


<div id="sec18-2" class="sec4">
	<h3>自作ログイン | ログインチェックとログアウト</h3>
	
	<a href="/sample/php/a060/original_login/" class="btn btn-info">Demo</a><br>
	<br>
	
	demo2.php(main)
	<pre><code>
	&lt;?php 
	// ログインチェック
	session_start();
	if(empty($_SESSION['uid'])){
		$_SESSION['referer'] = $_SERVER['REQUEST_URI'];
		header('Location: demo2_login.php');
		exit;
	}
	?&gt;
	ログインが必要なページです。&lt;br&gt;
	&lt;a href="demo2_logout.php" class="btn btn-default"&gt;ログアウト&lt;/a&gt;&lt;br&gt;
	</code></pre>
	<br>
	
	demo2_login.php
	<pre><code>
	&lt;?php 
	if(!empty($_POST['login_submit'])){
		session_start();
		if(empty($_SESSION['uid'])){
			$pw_hash2 = getTestPwHash();
			if(password_verify($_POST['password'], $pw_hash2)){
				session_regenerate_id(true); // セッションの更新
				$_SESSION['uid'] =$_POST['uid'];
				header('Location: ' . $_SESSION['referer']);// 遷移元のページにリダイレクトする。
				exit();
			}else{
				print 'ログイン失敗';
			}
		}
	}
	
	function getTestPwHash(){
		// 本来は、DBからユーザーIDにひもづくパスワードハッシュを取得処理である。
		// テスト用にパスワードハッシュを直に記述している。
		$pw='hogehoge'; // テストパスワード
		$pw_hash = password_hash($pw, PASSWORD_DEFAULT);
		return $pw_hash;
	}
	?&gt;
	
	&lt;form action="#" method="post"&gt;
		&lt;input name="uid" type="text" /&gt;&lt;br&gt;
		&lt;input name="password" type="password" /&gt;テスト用パスワード→hogehoge&lt;br&gt;
		&lt;input type="submit" name="login_submit" value="Login" class="btn btn-primary"/&gt;
	&lt;/form&gt;
	</code></pre><br>
	
	demo2_logout.php
	<pre><code>
	&lt;?php 
	session_start();
	$_SESSION['uid'] = null;
	?&gt;
	ログアウトしました。&lt;br&gt;
	&lt;a href="demo2.php"&gt;demo2へ戻る&lt;/a&gt;&lt;br&gt;
	&lt;br&gt;
	</code></pre><br>


	<br><time>2020-3-8</time>
</div>


<div id="sec18-3" class="sec4">
	<h3>メール送信 | mb_send_mail</h3>

	<pre><code>
	$to = "example@example.com"; // 宛先メールアドレス
	$subject = "テストメールのタイトル";
	$message = "こんにちは　テストメールです。\n本日の天気はいかがですか。";
	$headers = "";
	mb_send_mail($to, $subject, $message, $headers);
	</code></pre>
	<br>
	このサンプルは、さくらレンタルサーバー（スタンダードプラン）の環境で動作する。
	ローカル環境では動作しない。<br>
	「$headers」は空でよい。下手に値を指定すると受信側にて警告メッセージが表示されてしまう。<br>
	メール文章の改行は「\n」。
	<br>

	<br><time>2020-3-8</time>
</div>


<div id="sec18-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time>2020-3-8</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/js/">JavaScriptの覚書</a></li>
	<li>PHPの覚書</li>
</ol>
</div><!-- content -->
<div id="footer">(C) kenji uehara 2020-3-8</div>
</body>
</html>