<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Google Maps Platformの覚書 | ワクガンス</title>
	<link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">

	<script src="/note_prg/js/jquery3.js"></script>	<!-- jquery-3.3.1.min.js -->
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>

	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>Google Maps Platformの覚書 | ワクガンス</h1></div>
<div class="container">


<div id="sec1-1" class="sec4">
	<h3>Maps Static APIを利用するまでの手順</h3>
	
	<ol class="list_lg">
		<li>
			googleアカウントを用意する。
			<aside>アカウントは使用可能なクレジットカードまたはデビッドカードの関連づけ設定が必要。</aside>
			<a href="https://cloud.google.com/" target="blank">Google Cloud Platform</a>
			にアクセスしログインする。<br>
			左上のプロジェクト名部分を選択する。<br>
			<img src="img/gmap_note/sec1-1a1.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			新しい任意のプロジェクト名を入力し「作成」ボタンを押す。<br>
			<img src="img/gmap_note/sec1-1a3.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			左上の部分が先ほど入力したプロジェクト名になっていることを確認する。<br>
			「Maps Static API」を使用するため、「ライブラリ」をクリックする。<br>
			<img src="img/gmap_note/sec1-1a4.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			検索テキストボックスに「Maps Static API」を入力してAPIを検索する。<br>
			検索されたAPIの中から「Maps Static API」を選択する。<br>
			<img src="img/gmap_note/sec1-1a6.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			「有効」ボタンを押す。<br>
			<img src="img/gmap_note/sec1-1a7.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			次にAPIキーを作成するため、「認証情報」タブをクリックする。<br>
			<img src="img/gmap_note/sec1-1a8.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			「認証情報を作成」を押す。<br>
			<img src="img/gmap_note/sec1-1a12.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			作成されたAPIキーを確認し「完了」ボタンを押す。<br>
			<img src="img/gmap_note/sec1-1a13.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			APIキーをコピペして保持しておく。<br>
			
			<aside>
				このAPIキーを使えば地図表示ができるようになるが、だれでもこのAPIキーを使えてしまうので制限をかける必要がある。<br>
				詳しくは「<a href="#sec1-2">APIキーに制限をかける</a>」を参考。
			</aside>
			<img src="img/gmap_note/sec1-1a14.png" class="img_compact_k" />
			<br>
		</li>
		
		<li>
			地図を記載したいhtmlファイルに下記を記述する。
			【APIキー】部分に上記で保持していたAPIキーを記述する。<br>
<pre><code>
	&lt;img src="https://maps.googleapis.com/maps/api/staticmap
		?center=26.676750,127.908177
		&amp;zoom=15
		&amp;size=640x480
		&amp;key=【APIキー】" /&gt;
</code></pre>
			<a href="/sample/js/a011/maps_static_api/demo1.html" class="btn btn-info">Demo</a><br>
			<br>
		</li>
	</ol>


	<br><time>2019-3-26</time>
</div>


<div id="sec1-2" class="sec4">
	<h3>APIキーに制限をかける</h3>
	
	<ol class="list_lg">
		<li>
			「Google Cloud Platform」にアクセスしAPIを選択する。<br>
			<img src="img/gmap_note/sec1-3a1.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			「認証情報」をクリックし、APIキー一覧から該当する行の「編集」アイコンを押下。<br>
			<img src="img/gmap_note/sec1-2a1.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			「HTTPリファラ（ウェブサイト）」を選択し、URLのフィルターを入力する。<br>
			例→ http://amaraimusi.sakura.ne.jp/*<br>
			<img src="img/gmap_note/sec1-2a2.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			「キーを宣言」、フィルタの「Maps Static API」にチェックを入れ、「保存」ボタンを押したら制限完了。<br>
			<aside>実際に制限がかかるまで2，3分かかるように思える。</aside>
			<img src="img/gmap_note/sec1-2a3.png" class="img_compact_k" />
			<br>
		</li>
	</ol>


	<br><time>2019-3-26</time>
</div>


<div id="sec1-3" class="sec4">
	<h3>表示回数制限</h3>
	
	1日の表示上限、100秒間の表示上限、1ユーザーの100秒間表示上限ができる。<br>
	とりあえず1日の表示上限だけでも適切に設定すれば無課金にできる。<br>
	<br>
	
	<ol class="list_lg">
		<li>
			「Google Cloud Platform」にアクセスしAPIを選択する。<br>
			<img src="img/gmap_note/sec1-3a1.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			ダッシュボードのAPI一覧から「Maps Static API」をクリック。<br>
			<img src="img/gmap_note/sec1-3a2.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			「割り当て」タブを選択する。<br>
			<img src="img/gmap_note/sec1-3a3.png" class="img_compact_k" />
			<br>
		</li>
		<li>
			「割り当て」タブを選択している状態で少し下にスクロールすると表示制限ができる。<br>
		
			<table class="tbl2"><tbody>
				<tr>
					<td>Requests with a signature per day</td>
					<td>一日の表示上限</td>
					<td>Maps Static API(ウェブ)は月10万件まで無料なので、31日で割り、3200くらいを設定してみる。</td>
				</tr>
				<tr>
					<td>Requests with a signature per 100 seconds</td>
					<td>100秒間の表示上限</td>
					<td>集中アクセスを防ぐ目的の設定と思われる。とりあえず、100秒間の上限は500回くらいにしておけばよかろう。</td>
				</tr>
				<tr>
					<td>Requests with a signature per 100 seconds per user</td>
					<td>1ユーザーの100秒間の表示上限</td>
					<td>
						ここの設定でDOSアタックや悪質なスクレイピングをある程度防げる。<br>
						100秒間に20回で良かろう。もう少し少なくてもいいかもしれない。
					</td>
				</tr>
				
			</tbody></table><br>
			<p>変更前（一部変更済み）</p>
			<img src="img/gmap_note/sec1-3a4.png" />
			<br>
			<p>変更後</p>
			<img src="img/gmap_note/sec1-3a6.png" />
			<br>
			<hr>
			変更の注意<br>
			数値を変更すると「保存」が押せなくなるが、チェックボックスにチェックを入れると押せるようになる。<br>
			<img src="img/gmap_note/sec1-3a5.png" class="img_compact_k" />
		</li>
		<li>
			「未署名のリクエスト（URL署名シークレットが定義されている場合）」という似たような設定がある。<br>
			よくわからないがとりあえず同様に設定を変更する。<br>
			<img src="img/gmap_note/sec1-3a7.png" class="img_compact_k" />
			<br>
		</li>
	</ol>
	
	<hr>
	<p>参考サイト</p>
	<ul>
		<li><a href="https://stackoverflow.com/questions/50289374/new-google-maps-platform-how-do-i-set-my-own-usage-limits" class="btn btn-link btn-xs" target="blank">
			自分の使用制限を設定する方法</a></li>	
		<li><a href="https://ring-and-link.co.jp/dream2000/user/notice/web/2975" class="btn btn-link btn-xs" target="blank">
			Google Maps PlatformのAPI 使用の上限設定</a></li>
	</ul>


	<br><time>2019-3-27</time>
</div>


<div id="sec1-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time>2019-3-12</time>
</div>


<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/js/">JavaScriptの覚書</a></li>
	<li>Google Maps Platformの覚書</li>
</ol>
</div><!-- content -->
<div id="footer">(C) kenji uehara 2019-3-26</div>
</body>
</html>