<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="google" content="notranslate" />
   	<meta http-equiv="X-UA-Compatible" content="IE=edge">
   	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQLの覚書 | MySQLのコマンド</title><link rel='shortcut icon' href='/home/images/favicon.ico' />
	
	<link href="/note_prg/css/jquery-ui.min.css" rel="stylesheet">
	<link href="/note_prg/css/bootstrap.min.css" rel="stylesheet">
	<link href="/note_prg/css/highlight/default.css" rel="stylesheet">
	<link href="/note_prg/css/common2.css" rel="stylesheet">

	<script src="/note_prg/js/jquery-1.11.1.min.js"></script>
	<script src="/note_prg/js/jquery-ui.min.js"></script>
	<script src="/note_prg/js/bootstrap.min.js"></script>
	<script src="/note_prg/js/highlight.pack.js"></script>
	<script src="/note_prg/js/livipage.js"></script>
	<script src="/note_prg/js/ImgCompactK.js"></script>


	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div id="header" ><h1>MySQLの覚書 | MySQLのコマンド</h1></div>
<div class="container">




<div id="sec1-1" class="sec4">
	<h3>MySQLのコマンドを動かす | ローカル</h3>
	
	ローカル環境でMySQLコマンドを使うにはXAMPP Controll Panelに付属するShellツールを使うとよい。<br>
	<br>
	
	コントロールパネルに付属するShellを起動する<br>
	<img src="img/cmd_note/sec1-1a1.png" class="img_compact_k" /><br>
	<br>

	MySQLへのログイン→DB選択→SELECT文の実行までの流れ
	<pre class="console">
	# mysql -u （ユーザー名） -p
	Enter password: （パスワード）
	MariaDB [(none)]> use animal_db
	Database changed
	MariaDB [animal_db]> select * from animals
	</pre><br>
	
	<p>ワンライナーでログインすることもできる</p>
	<pre class="console">
	# mysql -uユーザー名 -pパスワード
	</pre>
	-uとユーザー名の間にスペースを空けないこと。-pも同様。<br>
	<br>

	<br><time>2018-5-2 | 2018-9-4</time>
</div>





<div id="sec1-1-2" class="sec4" >
	<h3>MySQLのコマンドを動かす | Git Bash</h3>
	
	Git Bashからmysqlコマンドを使うには環境変数の設定と「winpty」コマンドを使わねばならない。<br>
	<br>
	
	<p>環境変数の設定</p>
	<ol>
		<li>
			環境変数の設定画面を開く。<br>
			<aside>Windows10なら左下の検索ボックスに「環境変数」と入力すると容易に環境変数の設定画面にたどり着ける。<br></aside>
		</li>
		<li>
			上段項目であるユーザー環境変数からPathを選択して編集ボタンを押す。<br>
			<img src="img/cmd_note/sec1-1-2a1.png" class="img_compact_k" />
		</li>
		<li>
			新規ボタンを押し、mysql.exeが存在するディレクトリパスを入力してOKボタンを押す。<br>
			<aside>xamppである場合、ディレクトリパスは「xampp\mysql\bin」になる。</aside>
			<img src="img/cmd_note/sec1-1-2a2.png" class="img_compact_k" />
		</li>
		<li>
			以上で環境変数の設定はおわり。<br>
			すでにGitBashが立ち上がっているなら、一旦閉じて再度開く。<br>
		</li>
	</ol><br>
	<br>

	<p>Git Bashからmysqlコマンドを使う</p>
	mysqlコマンドの前にwinptyを付け足す。
	<pre class="console">
	$ <strong>winpty</strong> mysql -v
	</pre>
	<br>
	補足：<br>
	winptyはmysqlに限らずwindowsではよくお目にかかるコマンドである。<br>
	<br>
	

	<br><time>2018-9-4</time>
</div>




<div id="sec1-2" class="sec4">
	<h3>MySQLをコマンドで動かす | サーバー（さくらサーバー）</h3>

	shellコマンドでさくらサーバー（スタンダードプラン）のＤＢにアクセスする。<br>
	Git for windowsのshellコマンドを検証を行った。<br>
	<br>
	
	SSHでまずはサーバーにログインする。（パスワードでログインする場合）
	<pre class="console">
	$ ssh -l （ユーザー名） （ユーザー名）.sakura.ne.jp
	$ password:（パスワード）
	</pre>
	
	続いてMySQLにログインする
	<pre class="console">
	% mysql -h mysqlXXX.db.sakura.ne.jp -u （ユーザー名） -p
	% Enter password:(MySQLのパスワード)
	</pre>
	
	対象のＤＢにアクセス
	<pre class="console">
	% mysql> use (ユーザー名)_animal_db
	</pre>
	
	SQLを実行
	<pre class="console">
	% mysql> select * from animals
	</pre>
	
	<br><time>2018-5-2</time>
</div>





<div id="sec1-3" class="sec4" >
	<h3>DBをバックアップ（エクスポート）する | mysqldump</h3>

	ローカル環境のMySQLからanimal_parkデータベースをバックアップする。<br>
	<br>
	
	<pre class="console">
	# mysqldump -u root -p animal_park > C:\rab\animal_park.sql
	Enter password: ****
	</pre><br>
	<br>
	
	パスワードを含めたワンライナーの記述方法(パスワードは「hoge」としたとき)
	<pre class="console">	# mysqldump -u root -phoge animal_park > C:\rab\animal_park.sql</pre>
	「p」とパスワードの間にスペースを空けないこと。<br>
	<br>
	

	<br><time>2018-5-3 | 2018-5-4</time>
</div>






<div id="sec1-4" class="sec4">
	<h3>リモートでバックアップする（さくらサーバー・スタンダードプラン） | DBのエクスポート</h3>

	<pre class="console">
	$ mysqldump --default-character-set=utf8 -h mysqlXXX.db.sakura.ne.jp -u 【ユーザー名】 -p 【ユーザー名】_animal_park > www/rab/sql_dump.sql
	Enter password: 【DBサーバーのパスワード】
	</pre>
	<aside>Git for windowsのGit bashツールにて確認</aside>
	
	<br><time>2018-5-3</time>
</div>






<div id="sec1-5" class="sec4">
	<h3>DBのリストア【ローカル】</h3>
	
	「create database 〇〇〇〇」コマンドであらかじめDBを作成しておく<br>
	<br>
	
	<pre class="console">
	# mysql -u root -p animal_park &lt; C:\rab\animal_park.sql
	Enter password: ****
	</pre>

	<aside>XAMPP Controll Panelのshellツールで確認。</aside>

	<br><time>2018-5-3</time>
</div>





<div id="sec1-6" class="sec4">
	<h3>DBのリストア【リモート】</h3>
	
	さくらサーバー（スタンダードプラン）、ターミナルはGit for windowsのGit bashで検証を行った。<br>
	<br>
	
	最初にサーバーへログインする
	<pre class="console">
	$ ssh -l 【ユーザー名】 【ユーザー名】.sakura.ne.jp
	Enter password:【パスワード】
	</pre><br>
	<br>

	sqlファイルをサーバーにアップする。アップはFTPでもよい。<br>
	アップ先のパスはどこでもよい。下記の例では「www/rab」にsqlファイルを配置している。<br>
	<br>
	サーバー側にデータベースを作成する。例→【ユーザー名】_animal_park<br>
	<br>

	リストアを実行する
	<pre class="console">
	% mysql -h mysqXXX.db.sakura.ne.jp -u 【ユーザー名】 -p -B 【ユーザー名】_animal_park &lt; www/rab/animal_park.sql
	Enter password:【DBのパスワード】
	</pre>
	
	<br><time>2018-5-4</time>
</div>





<div id="sec1-7" class="sec4">
	<h3>テーブルだけバックアップ</h3>
	
	<pre class="console">
	$ mysqldump --default-character-set=utf8 -u root -p animals nekos > C:\rab\nekos.sql
	</pre><br>

	データのみバックアップ
	<pre class="console">
	$ mysqldump --default-character-set=utf8 -u root -p -t animals nekos > C:\rab\nekos.sql
	</pre>

	<br><time>2018-5-8</time>
</div>





<div id="sec1-0" class="sec4" style="display:none">
	<h3>xxx</h3>


	<br><time></time>
</div>




<div class="yohaku"></div>
<ol class="breadcrumb">
	<li><a href="/">ホーム</a></li>
	<li><a href="/note_prg">プログラミングの覚書</a></li>
	<li><a href="/note_prg/mysql/">MySQLの覚書</a></li>
	<li>MySQLのコマンド</li>
</ol>
</div><!-- content -->
<div id="footer">(C) kenji uehara 2018-5-2</div>
</body>
</html>